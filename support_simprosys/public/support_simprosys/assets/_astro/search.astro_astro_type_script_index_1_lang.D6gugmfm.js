function w(t,e){let s;return function(...n){clearTimeout(s),s=setTimeout(()=>t.apply(this,n),e)}}const y="https://simprosys-stage.frappe.cloud";async function p(t){const e=document.getElementById("searchResults");try{const u=((await(await fetch(`${y}/api/method/support_simprosys.support_simprosys.api.search_blog?keyword=${t}`,{method:"GET",headers:{Authorization:"token c58178baf306cfa:b63c3d8ccfedf6c"},mode:"cors"})).json()).message||[]).slice(0,20);if(e.innerHTML="",u.length>0){const r=document.createElement("div");r.className="searchResults rounded-t-2xl rounded-b-2xl shadow-md bg-white max-h-80 overflow-y-auto",u.forEach((o,g)=>{const a=document.createElement("a");a.href=`/faq/${o.slug}`,a.className="result-item flex p-4 sm:p-5 gap-3 bg-white hover:bg-slate-100 hover:rounded-2xl border-b",a.innerHTML=`
          <img src="${y}/files/searchNote.svg" alt="noteIcon" />
          <div class="text-start">
            <p class="text-sm sm:text-base text-[#25282B]">
              ${I(o.blog_title,t)} <!-- Highlight the keyword in blog title -->
            </p>
            <p class="text-[#25282B] text-xs sm:text-sm opacity-70">
              ${o.first_level_category||"Unknown Category"} - ${o.second_level_category||"Unknown Category"}
            </p>
          </div>`,a.dataset.index=g,r.appendChild(a)}),e.appendChild(r),e.classList.remove("hidden"),l=-1,x()}else e.classList.add("hidden")}catch(s){console.error("Error fetching search results:",s)}}function I(t,e){if(!e)return t;const n=e.trim().split(/\s+/).filter(Boolean).map(r=>r.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")),u=new RegExp(`(${n.join("|")})`,"gi");return t.replace(u,r=>`<span class="bg-[#FFF8D1]">${r}</span>`)}//! Event listener for input with debounce
//! ----------------------------------- //
document.getElementById("searchInput").addEventListener("input",w(t=>{const e=t.target.value.trim();e.length>1?p(e):document.getElementById("searchResults").classList.add("hidden")},150));document.getElementById("searchInput").addEventListener("focus",t=>{const e=t.target.value.trim(),s=document.getElementById("searchResults");e.length>1?p(e):(s.innerHTML="",s.classList.add("hidden"))});let l=-1;function x(){const t=document.getElementById("searchInput"),e=document.getElementById("searchResults");t.addEventListener("keydown",s=>{const n=e.querySelectorAll(".result-item");n.length!==0&&(s.key==="ArrowDown"?(s.preventDefault(),l=(l+1)%n.length,E(n,l)):s.key==="ArrowUp"?(s.preventDefault(),l=(l-1+n.length)%n.length,E(n,l)):s.key==="Enter"&&l>=0&&(s.preventDefault(),n[l].click()))})}function E(t,e){t.forEach((s,n)=>{n===e?(s.classList.add("bg-slate-100","rounded-2xl"),s.scrollIntoView({block:"nearest"})):s.classList.remove("bg-slate-100","rounded-2xl")})}function k(t){p(t)}const L=document.querySelectorAll(".link-item"),m=document.getElementById("searchInput");L.forEach(t=>{t.addEventListener("click",e=>{m.value=e.target.textContent.trim(),m.focus(),m.setSelectionRange(m.value.length,m.value.length),k(m.value)})});document.getElementById("searchInput").addEventListener("keydown",t=>{if(t.key==="Enter"){const e=t.target.value.trim();e.length>=2&&(window.location.href=`/search?query=${encodeURIComponent(e)}`)}});document.addEventListener("DOMContentLoaded",async()=>{const e=new URLSearchParams(window.location.search).get("query")||"",s=document.getElementById("search-term"),n=document.getElementById("searchInput"),u=document.getElementById("searchCount"),r=document.getElementById("search-results");if(s&&(s.textContent=e||"None"),n&&(n.value=e),!!r)if(e.length>=2)try{const o=await fetch(`https://simprosys-stage.frappe.cloud/api/method/support_simprosys.support_simprosys.api.search_blog?keyword=${encodeURIComponent(e)}`,{method:"GET",headers:{Authorization:"token c58178baf306cfa:b63c3d8ccfedf6c"}});if(!o.ok)throw new Error(`HTTP error! Status: ${o.status}`);const a=(await o.json()).message||[];u&&(u.textContent=a.length.toString());const i={};if(a.forEach(d=>{const c=d.first_level_category||"Unknown",h=d.second_level_category||"Unknown";i[c]||(i[c]={}),i[c][h]||(i[c][h]=[]),i[c][h].push(d)}),a.length>0){let d="";Object.keys(i).forEach(c=>{Object.keys(i[c]).forEach(h=>{d+=`
                <p class="text-xl lg:text-2xl font-semibold mt-5">${h} - ${c}</p>
                <ul class="ml-4 mt-4">`,i[c][h].forEach(f=>{const v=I(f.blog_title,e);d+=`
                  <li class="seach-li p-1 lg:p-2">
                    <a href="/faq/${f.slug}" class="text-black text-lg hover:underline">${v}</a>
                  </li>`}),d+="</ul>"})}),r.innerHTML=d}else r.innerHTML='<p class="text-gray-500">No results found.</p>'}catch{r.innerHTML='<p class="text-red-500">Error fetching search results.</p>'}else r.innerHTML='<p class="text-gray-500">Please enter at least 2 characters.</p>'});document.getElementById("searchInput").addEventListener("input",w(t=>{let e=t.target.value.trim();e.length>100&&(e=e.substring(0,100),t.target.value=e),e.length>1?p(e):document.getElementById("searchResults").classList.add("hidden")},150));
