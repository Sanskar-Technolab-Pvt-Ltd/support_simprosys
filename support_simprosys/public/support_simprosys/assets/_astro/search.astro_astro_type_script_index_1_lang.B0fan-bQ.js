function f(t,e){let s;return function(...n){clearTimeout(s),s=setTimeout(()=>t.apply(this,n),e)}}const g="http://127.0.0.1:8000";async function h(t){const e=document.getElementById("searchResults");try{const c=((await(await fetch(`${g}/api/method/support_simprosys.support_simprosys.api.search_blog?keyword=${t}`,{method:"GET",headers:{Authorization:"token c58178baf306cfa:183cbe6e18ea543"},mode:"cors"})).json()).message||[]).slice(0,20);if(console.log(c),e.innerHTML="",c.length>0){const a=document.createElement("div");a.className="searchResults rounded-t-2xl rounded-b-2xl shadow-md bg-white max-h-80 overflow-y-auto",c.forEach((o,l)=>{const r=document.createElement("a");r.href=`/faq/${o.slug}`,r.className="result-item flex p-4 sm:p-5 gap-3 bg-white hover:bg-slate-100 hover:rounded-2xl border-b",r.innerHTML=`
          <img src="${g}/files/searchNote.svg" alt="noteIcon" />
          <div class="text-start">
            <p class="text-sm sm:text-base text-[#25282B]">
              ${y(o.blog_title,t)} <!-- Highlight the keyword in blog title -->
            </p>
            <p class="text-[#25282B] text-xs sm:text-sm opacity-70">
              ${o.first_level_category||"Unknown Category"} - ${o.second_level_category||"Unknown Category"}
            </p>
          </div>`,r.dataset.index=l,a.appendChild(r)}),e.appendChild(a),e.classList.remove("hidden"),d=-1,w()}else e.classList.add("hidden")}catch(s){console.error("Error fetching search results:",s)}}function y(t,e){if(!e)return t;const n=e.trim().split(/\s+/).filter(Boolean).map(a=>a.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")),c=new RegExp(`(${n.join("|")})`,"gi");return t.replace(c,a=>`<span class="bg-[#FFF8D1]">${a}</span>`)}//! Event listener for input with debounce
//! ----------------------------------- //
document.getElementById("searchInput").addEventListener("input",f(t=>{const e=t.target.value.trim();e.length>1?h(e):document.getElementById("searchResults").classList.add("hidden")},150));document.getElementById("searchInput").addEventListener("focus",t=>{const e=t.target.value.trim(),s=document.getElementById("searchResults");e.length>1?h(e):(s.innerHTML="",s.classList.add("hidden"))});let d=-1;function w(){const t=document.getElementById("searchInput"),e=document.getElementById("searchResults");t.addEventListener("keydown",s=>{const n=e.querySelectorAll(".result-item");n.length!==0&&(s.key==="ArrowDown"?(s.preventDefault(),d=(d+1)%n.length,p(n,d)):s.key==="ArrowUp"?(s.preventDefault(),d=(d-1+n.length)%n.length,p(n,d)):s.key==="Enter"&&d>=0&&(s.preventDefault(),n[d].click()))})}function p(t,e){t.forEach((s,n)=>{n===e?(s.classList.add("bg-slate-100","rounded-2xl"),s.scrollIntoView({block:"nearest"})):s.classList.remove("bg-slate-100","rounded-2xl")})}function I(t){h(t)}const v=document.querySelectorAll(".link-item"),u=document.getElementById("searchInput");v.forEach(t=>{t.addEventListener("click",e=>{u.value=e.target.textContent.trim(),u.focus(),u.setSelectionRange(u.value.length,u.value.length),I(u.value)})});document.getElementById("searchInput").addEventListener("keydown",t=>{if(t.key==="Enter"){const e=t.target.value.trim();e.length>=2&&(window.location.href=`/search?query=${encodeURIComponent(e)}`)}});document.addEventListener("DOMContentLoaded",async()=>{const e=new URLSearchParams(window.location.search).get("query")||"";if(document.getElementById("search-term").textContent=e||"None",document.getElementById("searchInput").value=e,e.length>=2)try{const s=await fetch(`http://127.0.0.1:8000/api/method/support_simprosys.support_simprosys.api.search_blog?keyword=${encodeURIComponent(e)}`,{method:"GET",headers:{Authorization:"token c58178baf306cfa:183cbe6e18ea543"}});if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);const n=await s.json();console.log("API Response:",n);const c=n.message||[],a=document.getElementById("search-results");document.getElementById("searchCount").textContent=c.length||"0";const o={};if(c.forEach(l=>{const r=l.first_level_category||"Unknown",i=l.second_level_category||"Unknown";o[r]||(o[r]={}),o[r][i]||(o[r][i]=[]),o[r][i].push(l)}),c.length>0){let l="";Object.keys(o).forEach(r=>{Object.keys(o[r]).forEach(i=>{l+=`
        <p class="text-xl lg:text-2xl font-semibold mt-5">${i} - ${r}</p>
        <ul class="ml-4 mt-4">`,o[r][i].forEach(m=>{const E=y(m.blog_title,e);l+=`
          <li class="seach-li p-1 lg:p-2">
            <a href="/faq/${m.slug}" class="text-black text-lg hover:underline">${E}</a>
          </li>`}),l+="</ul>"})}),a.innerHTML=l}else a.innerHTML='<p class="text-gray-500">No results found.</p>'}catch{document.getElementById("search-results").innerHTML='<p class="text-red-500">Error fetching search results.</p>'}else document.getElementById("search-results").innerHTML='<p class="text-gray-500">Please enter at least 2 characters.</p>'});document.getElementById("searchInput").addEventListener("input",f(t=>{let e=t.target.value.trim();e.length>100&&(e=e.substring(0,100),t.target.value=e),e.length>1?h(e):document.getElementById("searchResults").classList.add("hidden")},150));
